using System;
using System.Collections.Generic;
using System.Web;

using System.Data;
using System.Data.OleDb;

namespace SPMWebServiceApp.DataAccess
{
    public class SuperAdminDA
    {
        private GenericDA genericDA;
        OleDbCommand Command;
        OleDbConnection DBConnection;
        OleDbTransaction DBTransaction;

        public SuperAdminDA(GenericDA da)
        {
            genericDA = da;
        }

        public DataTable SuperAdmin_GetByFilters(String UserID, String AEGroup, int Start, int PageLength)
        {
            Command = new OleDbCommand("SPM_SuperAdmin_GetByFilters", genericDA.GetSqlConnectionNew());
            Command.CommandType = CommandType.StoredProcedure;
            Command.Parameters.AddWithValue("UserID", UserID);
            Command.Parameters.AddWithValue("AEGroup", AEGroup);
            Command.Parameters.AddWithValue("Start", Start);
            Command.Parameters.AddWithValue("PageLength", PageLength);

            OleDbDataAdapter DataAdapter = new OleDbDataAdapter(Command);
            DataTable dt = new DataTable();
            DataAdapter.Fill(dt);

            return dt;
        }

        public DataTable SuperAdmin_GetAEGroup(String AEGroup)
        {
            String sql = String.Empty;

            sql = "SELECT AE_CD_Sec AS AEGroup FROM AEList WHERE RefMonthYr = (SELECT MAX(RefMonthYr) FROM AEList) AND AE_CD_Sec LIKE '%" + AEGroup + "%';";

            return genericDA.ExecuteQueryForDataTable(sql, "dtAEGroup");
        }

        public DataTable SuperAdmin_GetUserID(String UserID)
        {
            String sql = String.Empty;

            sql = "SELECT UserID, AEName FROM DealerDetail AS DD WHERE DD.UserType NOT LIKE 'FAR%' AND (DD.UserType IS NULL OR DD.UserType = '') AND UserID LIKE '%" + UserID + "%' GROUP BY DD.UserID, DD.AEName ORDER BY DD.UserID;";

            return genericDA.ExecuteQueryForDataTable(sql, "dtUserID");
        }

        public DataTable SuperAdmin_GetAECode()
        {
            String sql = String.Empty;

            sql = "SELECT AECode FROM DealerDetail AS DD WHERE DD.UserType NOT LIKE 'FAR%' AND (DD.UserType IS NULL OR DD.UserType = '') GROUP BY DD.AECode ORDER BY DD.AECode;";

            return genericDA.ExecuteQueryForDataTable(sql, "dtAECode");
        }

        public String SuperAdmin_Delete(String UserID, String AEGroup)
        {
            try
            {
                DBConnection = new OleDbConnection(genericDA.GetSqlConnectionNew().ConnectionString);

                String sql = String.Empty;

                sql = "DELETE SuperAdmin WHERE UserID = '" + UserID + "' AND AEGroup = '" + AEGroup + "';";

                DBConnection.Open();
                DBTransaction = DBConnection.BeginTransaction();

                Command = new OleDbCommand(sql, DBConnection, DBTransaction);
                Command.ExecuteNonQuery();

                DBTransaction.Commit();
                DBConnection.Close();
            }
            catch (Exception ex)
            {
                DBTransaction.Rollback();
                DBConnection.Close();

                return ex.Message;
            }

            return "1";
        }

        public String SuperAdmin_Insert(String UserID, String AEGroup)
        {
            try
            {
                DBConnection = new OleDbConnection(genericDA.GetSqlConnectionNew().ConnectionString);

                String sql = String.Empty;

                sql = "INSERT INTO SuperAdmin (UserID, AEGroup) VALUES ('" + UserID + "', '" + AEGroup + "');";

                DBConnection.Open();
                DBTransaction = DBConnection.BeginTransaction();

                Command = new OleDbCommand(sql, DBConnection, DBTransaction);
                Command.ExecuteNonQuery();

                DBTransaction.Commit();
                DBConnection.Close();
            }
            catch (Exception ex)
            {
                DBTransaction.Rollback();
                DBConnection.Close();

                return ex.Message;
            }

            return "1";
        }
    }
}